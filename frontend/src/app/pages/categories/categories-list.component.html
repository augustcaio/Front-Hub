<div class="p-4 md:p-6 max-w-[1400px] mx-auto">
  <!-- Header -->
  <div class="mb-4 md:mb-8">
    <h1 class="m-0 mb-2 md:mb-3 text-2xl md:text-3xl font-semibold text-[var(--text-color)]">{{ 'categories.title' | translate }}</h1>
    <p class="m-0 text-sm md:text-base text-[var(--text-color-secondary)]">{{ 'categories.subtitle' | translate }}</p>
  </div>

  <!-- Toolbar com Filtros -->
  <p-card class="mb-4 md:mb-6">
    <p-toolbar class="p-toolbar-spacing">
      <div class="p-toolbar-group-start flex flex-col md:flex-row flex-wrap items-stretch md:items-center gap-2 md:gap-4 w-full md:w-auto">
        <!-- Search Input -->
        <div class="w-full md:flex-none md:min-w-[200px] [&_.p-input-icon-left]:w-full [&_.p-input-icon-left_input]:w-full">
          <span class="p-input-icon-left w-full">
            <i class="pi pi-search"></i>
            <input
              type="text"
              pInputText
              [(ngModel)]="searchText"
              (input)="onSearch()"
              [placeholder]="'categories.searchPlaceholder' | translate"
              class="w-full"
            />
          </span>
        </div>

        <!-- Clear Search Button -->
        <div class="w-full md:w-auto [&_.p-button]:w-full" *ngIf="searchText">
          <p-button
            [label]="'categories.clearFilters' | translate"
            icon="pi pi-times"
            [styleClass]="'p-button-outlined w-full'"
            (click)="clearSearch()">
          </p-button>
        </div>
      </div>

      <div class="p-toolbar-group-end flex flex-col md:flex-row gap-2 md:gap-3 w-full md:w-auto mt-2 md:mt-0">
        <div class="w-full md:w-auto [&_.p-button]:w-full">
          <p-button
            [label]="'categories.newCategory' | translate"
            icon="pi pi-plus"
            [styleClass]="'p-button-primary w-full'"
            routerLink="/categories/new"
            [disabled]="!(isAdmin$ | async)">
          </p-button>
        </div>
        <div class="w-full md:w-auto [&_.p-button]:w-full">
          <p-button
            [label]="'categories.refresh' | translate"
            icon="pi pi-refresh"
            [styleClass]="'p-button-outlined w-full'"
            [loading]="loading"
            (click)="refresh()">
          </p-button>
        </div>
      </div>
    </p-toolbar>
  </p-card>

  <!-- Toast e Confirm Dialog -->
  <p-toast></p-toast>
  <p-confirmDialog></p-confirmDialog>

  <!-- Loading State -->
  <div *ngIf="loading" class="flex flex-col items-center justify-center p-8 md:p-12 text-center">
    <p-progressSpinner [style]="{ width: '50px', height: '50px' }"></p-progressSpinner>
    <p class="mt-4 text-sm md:text-base text-[var(--text-color-secondary)]">{{ 'categories.loadingCategories' | translate }}</p>
  </div>

  <!-- Error State -->
  <div *ngIf="error && !loading" class="mb-4 md:mb-6">
    <p-card>
      <div class="flex flex-col items-center gap-3 md:gap-4 p-4">
        <i class="pi pi-exclamation-triangle text-4xl md:text-5xl text-red-500"></i>
        <p class="m-0 text-sm md:text-base text-center text-[var(--text-color)]">{{ error }}</p>
        <p-button
          [label]="'categories.tryAgain' | translate"
          icon="pi pi-refresh"
          (click)="refresh()"
          [styleClass]="'p-button-outlined w-full md:w-auto'">
        </p-button>
      </div>
    </p-card>
  </div>

  <!-- Categories Table -->
  <div *ngIf="!loading && !error">
    <!-- Empty State -->
    <div *ngIf="categories.length === 0" class="mt-4 md:mt-6">
      <p-card>
        <div class="flex flex-col items-center gap-3 md:gap-4 p-6 md:p-8 text-center">
          <i class="pi pi-inbox text-5xl md:text-6xl text-[var(--text-color-secondary)]"></i>
          <p class="m-0 text-sm md:text-base px-4 text-[var(--text-color-secondary)]">
            <span *ngIf="searchText">{{ 'categories.noCategoriesFoundWithFilters' | translate }}</span>
            <span *ngIf="!searchText">{{ 'categories.noCategoriesRegistered' | translate }}</span>
          </p>
          <p-button
            *ngIf="searchText"
            [label]="'categories.clearFilters' | translate"
            icon="pi pi-times"
            (click)="clearSearch()"
            [styleClass]="'w-full md:w-auto'">
          </p-button>
        </div>
      </p-card>
    </div>

    <!-- Table -->
    <p-card *ngIf="categories.length > 0" class="p-card-body-spacing">
      <p-table
        [value]="categories"
        [paginator]="true"
        [rows]="rows"
        [first]="first"
        [totalRecords]="totalRecords"
        [lazy]="false"
        [loading]="loading"
        (onPage)="onPageChange($event)"
        [rowsPerPageOptions]="[10, 20, 50]"
        responsiveLayout="scroll"
        [showCurrentPageReport]="true"
        [currentPageReportTemplate]="getCurrentPageReportTemplate()"
        styleClass="p-datatable-sm">
        
        <ng-template pTemplate="header">
          <tr>
            <th pSortableColumn="name" class="p-table-spacing">{{ 'categories.tableHeaders.name' | translate }} <p-sortIcon field="name"></p-sortIcon></th>
            <th class="p-table-spacing">{{ 'categories.tableHeaders.description' | translate }}</th>
            <th pSortableColumn="created_at" class="p-table-spacing">{{ 'categories.tableHeaders.createdAt' | translate }} <p-sortIcon field="created_at"></p-sortIcon></th>
            <th pSortableColumn="updated_at" class="p-table-spacing">{{ 'categories.tableHeaders.updatedAt' | translate }} <p-sortIcon field="updated_at"></p-sortIcon></th>
            <th style="width: 12rem" class="p-table-spacing">{{ 'categories.tableHeaders.actions' | translate }}</th>
          </tr>
        </ng-template>

        <ng-template pTemplate="body" let-category>
          <tr>
            <td class="p-table-spacing">
              <span class="font-semibold text-[var(--text-color)]">{{ category.name }}</span>
            </td>
            <td class="p-table-spacing">
              <span *ngIf="category.description" class="text-[var(--text-color-secondary)]">
                {{ category.description.length > 50 ? (category.description | slice:0:50) + '...' : category.description }}
              </span>
              <span *ngIf="!category.description" class="text-[var(--text-color-secondary)] italic">
                {{ 'categories.noDescription' | translate }}
              </span>
            </td>
            <td class="p-table-spacing">
              <span class="text-[var(--text-color-secondary)]">
                {{ formatDate(category.created_at) }}
              </span>
            </td>
            <td class="p-table-spacing">
              <span class="text-[var(--text-color-secondary)]">
                {{ formatDate(category.updated_at) }}
              </span>
            </td>
            <td class="p-table-spacing">
              <div class="flex gap-1.5 md:gap-3">
                <p-button
                  icon="pi pi-pencil"
                  [styleClass]="'p-button-outlined p-button-sm'"
                  [routerLink]="['/categories', category.id, 'edit']"
                  [pTooltip]="'common.edit' | translate"
                  tooltipPosition="top"
                  [disabled]="!(isAdmin$ | async)">
                </p-button>
                <p-button
                  icon="pi pi-trash"
                  [styleClass]="'p-button-danger p-button-outlined p-button-sm'"
                  (click)="confirmDelete(category)"
                  [pTooltip]="'common.delete' | translate"
                  tooltipPosition="top"
                  [disabled]="!(isAdmin$ | async)">
                </p-button>
              </div>
            </td>
          </tr>
        </ng-template>

        <ng-template pTemplate="emptymessage">
          <tr>
            <td colspan="5" class="text-center p-8">
              <div class="flex flex-col items-center gap-4">
                <i class="pi pi-inbox text-4xl text-[var(--text-color-secondary)]"></i>
                <p class="text-[var(--text-color-secondary)]">{{ 'categories.noCategoriesFound' | translate }}</p>
              </div>
            </td>
          </tr>
        </ng-template>
      </p-table>
    </p-card>
  </div>
</div>

